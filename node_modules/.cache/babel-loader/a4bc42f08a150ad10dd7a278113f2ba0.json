{"ast":null,"code":"import _regeneratorRuntime from\"/home/anand/Music/jabtrac/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/anand/Music/jabtrac/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from\"axios\";import jquery from\"jquery\";import{LOGIN_SUCCESS,LOGIN_FAIL,LOAD_USER_SUCCESS,LOAD_USER_FAILS,AUTHENTICATED_SUCCESS,AUTHENTICATED_FAIL,LOGOUT}from\"./Types\";import{jsx as _jsx}from\"react/jsx-runtime\";export var load_user=function load_user(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var config,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!localStorage.getItem(\"token\")){_context.next=14;break;}config={headers:{\"Content-Type\":\"application/json\",Authorization:\"token \".concat(localStorage.getItem(\"token\")),Accept:\"application/json\",'X-CSRFToken':csrftoken}};_context.prev=2;_context.next=5;return axios.get(\"http://127.0.0.1:8000/accounts/user/\",config);case 5:res=_context.sent;dispatch({type:LOAD_USER_SUCCESS,payload:res.data});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](2);dispatch({type:LOAD_USER_FAILS});case 12:_context.next=15;break;case 14:dispatch({type:LOAD_USER_FAILS});case 15:case\"end\":return _context.stop();}}},_callee,null,[[2,9]]);}));return function(_x){return _ref.apply(this,arguments);};}();};export var login=function login(email){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var config,body,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={headers:{\"Content-Type\":\"application/json\",'X-CSRFToken':csrftoken}};body=JSON.stringify({email:email});_context2.prev=2;_context2.next=5;return axios.post(\"http://127.0.0.1:8000/accounts/login/\",body,config);case 5:res=_context2.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data});dispatch(load_user());_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](2);dispatch({type:LOGIN_FAIL});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[2,10]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var checkAuthenticated=function checkAuthenticated(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var config,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!localStorage.getItem('token')){_context3.next=16;break;}config={headers:{\"Content-Type\":\"application/json\",Authorization:\"token \".concat(localStorage.getItem(\"token\")),Accept:\"application/json\",'X-CSRFToken':csrftoken}};_context3.prev=2;_context3.next=5;return axios.get(\"http://127.0.0.1:8000/accounts/user/\",config);case 5:res=_context3.sent;dispatch(load_user());dispatch({type:AUTHENTICATED_SUCCESS,payload:res.data});dispatch(load_user());_context3.next=14;break;case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](2);dispatch({type:AUTHENTICATED_FAIL});case 14:_context3.next=17;break;case 16:dispatch({type:AUTHENTICATED_FAIL});case 17:case\"end\":return _context3.stop();}}},_callee3,null,[[2,11]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();};var csrftoken=getCookie('csrftoken');var CSRFToken=function CSRFToken(){return/*#__PURE__*/_jsx(\"input\",{type:\"hidden\",name:\"csrfmiddlewaretoken\",value:csrftoken});};export default CSRFToken;function getCookie(name){var cookieValue=null;if(document.cookie&&document.cookie!==''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jquery.trim(cookies[i]);if(cookie.substring(0,name.length+1)===name+'='){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}return cookieValue;}export var logout=function logout(){return function(dispatch){if(localStorage.getItem(\"token\")){// const config = {\n//   headers: {\n//     \"Content-Type\": \"application/json\",\n//     Authorization: `token ${localStorage.getItem(\"token\")}`,\n//     Accept: \"application/json\",\n//     'X-CSRFToken': csrftoken\n//   },\n// };\ntry{var res=axios.post(\"http://127.0.0.1:8000/accounts/logout/\");console.log('logout success');dispatch({type:LOGOUT,payload:res.data});}catch(err){dispatch({type:LOGOUT});}}};};","map":{"version":3,"sources":["/home/anand/Music/jabtrac/src/Actions/Auth.js"],"names":["axios","jquery","LOGIN_SUCCESS","LOGIN_FAIL","LOAD_USER_SUCCESS","LOAD_USER_FAILS","AUTHENTICATED_SUCCESS","AUTHENTICATED_FAIL","LOGOUT","load_user","dispatch","localStorage","getItem","config","headers","Authorization","Accept","csrftoken","get","res","type","payload","data","login","email","body","JSON","stringify","post","checkAuthenticated","getCookie","CSRFToken","name","cookieValue","document","cookie","cookies","split","i","length","trim","substring","decodeURIComponent","logout","console","log","err"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport jquery from \"jquery\";\nimport {\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOAD_USER_SUCCESS,\n  LOAD_USER_FAILS,\n  AUTHENTICATED_SUCCESS,\n  AUTHENTICATED_FAIL,\n  LOGOUT,\n} from \"./Types\";\n\n\n\n\nexport const load_user = () => async (dispatch) => {\n  if (localStorage.getItem(\"token\")) {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `token ${localStorage.getItem(\"token\")}`,\n        Accept: \"application/json\",\n        'X-CSRFToken': csrftoken\n      },\n    };\n\n    try {\n      const res = await axios.get(\n        `http://127.0.0.1:8000/accounts/user/`,\n        config\n      );\n\n      dispatch({\n        type: LOAD_USER_SUCCESS,\n        payload: res.data,\n      });\n    } catch (err) {\n      dispatch({\n        type: LOAD_USER_FAILS,\n      });\n    }\n  } else {\n    dispatch({\n      type: LOAD_USER_FAILS,\n    });\n  }\n};\n\n\n\nexport const login = (email) => async (dispatch) => {\n  const config = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      'X-CSRFToken': csrftoken\n    },\n  };\n\n\n  const body = JSON.stringify({ email });\n\n  try {\n    const res = await axios.post(\n      `http://127.0.0.1:8000/accounts/login/`,\n      body,\n      config\n    );\n\n    dispatch({\n      type: LOGIN_SUCCESS,\n      payload: res.data,\n    });\n\n    dispatch(load_user());\n  } catch (err) {\n    dispatch({\n      type: LOGIN_FAIL,\n    });\n  }\n};\n\n\n\nexport const checkAuthenticated = () => async dispatch => {\n  if (localStorage.getItem('token')) {\n      const config = {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `token ${localStorage.getItem(\"token\")}`,\n            Accept: \"application/json\",\n            'X-CSRFToken': csrftoken,\n          }\n      }; \n\n      try {\n        const res = await axios.get(\n          `http://127.0.0.1:8000/accounts/user/`,\n          config\n        );\n        dispatch(load_user()); \n        dispatch({\n          type: AUTHENTICATED_SUCCESS,\n          payload: res.data,\n        });\n\n      dispatch(load_user());  \n      } catch (err) {\n        dispatch({\n          type: AUTHENTICATED_FAIL,\n        });\n      }\n    } else {\n      dispatch({\n        type: AUTHENTICATED_FAIL,\n      });\n    }\n  };\n\n\n\nvar csrftoken = getCookie('csrftoken');\n\nconst CSRFToken = () => {\n    return (\n        <input type=\"hidden\" name=\"csrfmiddlewaretoken\" value={csrftoken} />\n    );\n};\nexport default CSRFToken;\n\n\nfunction getCookie(name) {\n    var cookieValue = null;\n    if (document.cookie && document.cookie !== '') {\n        var cookies = document.cookie.split(';');\n        for (var i = 0; i < cookies.length; i++) {\n            var cookie = jquery.trim(cookies[i]);\n            if (cookie.substring(0, name.length + 1) === (name + '=')) {\n                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n                break;\n            }\n        }\n    }\n    return cookieValue;\n}\n\n\n\nexport const logout = () => (dispatch) => {\n  if (localStorage.getItem(\"token\")) {\n    // const config = {\n    //   headers: {\n    //     \"Content-Type\": \"application/json\",\n    //     Authorization: `token ${localStorage.getItem(\"token\")}`,\n    //     Accept: \"application/json\",\n    //     'X-CSRFToken': csrftoken\n    //   },\n    // };\n\n    try {\n      const res = axios.post(\n        `http://127.0.0.1:8000/accounts/logout/`,\n      );\n        console.log('logout success')\n      dispatch({\n        type: LOGOUT,\n        payload: res.data,\n      });\n    } catch (err) {\n      dispatch({\n        type: LOGOUT,\n      });\n    }\n  }\n}\n  \n  "]},"metadata":{},"sourceType":"module"}